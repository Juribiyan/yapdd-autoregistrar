# YaPDD-Autoregistrar
Свободная, анонимная и автоматическая регистрация в [Яндекс.Почте для доменов](https://pdd.yandex.ru/). 

С тех пор, как Яндекс запретил свободную регистрацию в почте для доменов, единственной возможностью это сделать стал доступ через [API](https://api.yandex.ru/pdd/).  Перед вами простой скрипт, реализующий это. Для защиты от массовой регистрации в скрипте применяется капча и ограничение на количество ящиков с одного IP.

## Требования
* PHP с установленным libcurl
* MySQL/PostgreSQL/SQLite
* Подключенный к Яндекс.Почте домен
* Аккаунт на hcaptcha.com

## Установка
0) [Подключите домен к Яндекс.Почте](https://pdd.yandex.ru/domains_add/), следуя инструкциям.

Как и [gsap-лупы](https://github.com/Juribiyan/gsap-l00ps), Авторегистратор может присасываться к конфигурации установленного [Instant 0chan](https://github.com/Juribiyan/instant-0chan). В этом случае пропустите пункты 1–3. Файл `standalone_config.php` и директория `standalone` при этом могут быть удалены.

### Самостоятельная конфигурация (`CONFIG_ENVIRONMENT=="standalone"`)
1) Создайте базу данных (если планируется использовать существующую базу даных, пропустите этот пункт).

2) Отредактируйте `standalone_config.php`:
* `KU_DBTYPE` *("mysqli" | "sqlite" | ...)* — [тип базы данных](http://phplens.com/adodb/supported.databases.html).  Скорее всего, это будет mysqli.
* `KU_DB`... — креденциали доступа к базе данных.
    
3) Из папки `standalone` переместите файлы в директорию установки почты. В ней содержится капча и библиотека ADODB. Подтвердите замену файла index.html (он отличается только url капчи)

### Общая когфигурация
4) Выполните импорт `mailip.sql` в базу данных. При необходимости отредактируйте название таблицы, если "mailip" вам чем-то не угодило.

5) Отредактируйте `common_config.php`:
* `CONFIG_ENVIRONMENT` *("instant" | "standalone")* — вариант конфигурации.
* `DOMAIN` *(строка)* — домен, к котором подключена почта (без префиксов и слешей)
* `PDD_TOKEN` *(строка)* — получить [здесь](https://pddimp.yandex.ru/api2/admin/get_token).
* `SALT` *(строка)* — любой случайный набор символов.
* `MAILBOXES_PER_IP` *(число)* — сколько ящиков можно регистрировать с одного IP.
* `MAIL_IP_TABLE` *(строка)* — имя таблицы (см. п.4)
* `BANNED_NAMES` *(массив)* — список запрещенных логинов.
* `I0_HCAPTCHA_SITEKEY` и `I0_HCAPTCHA_SECRET` *(строки)* — необходимо получить, зарегистрировавшись на сайте hCaptcha.
* **`$ip`** — способ получения IP пользователя. **Важно задать правильнsq хедер, если вы используете реверс-проксирование (например, Cloudflare)**
    
На этом установку Авторегистратора можно считать завершенной.
